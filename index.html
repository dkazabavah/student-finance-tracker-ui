<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Finance Tracker</title>
  <link rel="stylesheet" href="./styles/main.css" />
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <header class="site-header">
    <div class="wrap header-row">
      <div class="brand">
        <span class="logo" aria-hidden="true">₣</span>
        <div>
          <h1 class="title">Student Finance Tracker</h1>
          <p class="subtitle">Budgets, transactions, regex search, and stats — all offline.</p>
        </div>
      </div>

      <nav class="site-nav" aria-label="Primary">
        <button class="tab-btn" data-tab="dashboard" type="button">Dashboard</button>
        <button class="tab-btn" data-tab="records" type="button">Records</button>
        <button class="tab-btn" data-tab="add" type="button">Add/Edit</button>
        <button class="tab-btn" data-tab="settings" type="button">Settings</button>
        <button class="tab-btn" data-tab="about" type="button">About</button>
      </nav>
    </div>
  </header>

  <main id="main" class="wrap" tabindex="-1">
    <!-- ARIA live regions -->
    <div class="sr-only" id="liveStatus" role="status" aria-live="polite"></div>
    <div class="sr-only" id="liveAlert" aria-live="assertive"></div>

    <!-- DASHBOARD -->
    <section class="panel" id="panel-dashboard" aria-labelledby="h-dashboard">
      <header class="panel-head">
        <h2 id="h-dashboard">Dashboard / Stats</h2>
        <p class="muted">Quick view of totals, top category, and last 7 days trend.</p>
      </header>

      <div class="stats-grid">
        <article class="stat-card" aria-label="Total records">
          <h3>Total records</h3>
          <p class="stat" id="statTotalRecords">0</p>
        </article>

        <article class="stat-card" aria-label="Total spent">
          <h3>Total spent</h3>
          <p class="stat" id="statTotalSpent">0</p>
          <p class="muted small" id="statCurrencyNote">Base currency: RWF</p>
        </article>

        <article class="stat-card" aria-label="Top category">
          <h3>Top category</h3>
          <p class="stat" id="statTopCategory">—</p>
        </article>

        <article class="stat-card" aria-label="Budget cap">
          <h3>Cap / Target</h3>
          <p class="stat" id="statCap">—</p>
          <p class="muted small" id="statCapMsg">Set a cap in Settings.</p>
        </article>
      </div>

      <section class="trend" aria-labelledby="h-trend">
        <div class="trend-head">
          <h3 id="h-trend">Last 7 days trend</h3>
          <p class="muted small">Simple chart: daily totals (base currency).</p>
        </div>
        <div class="chart" role="img" aria-label="Bar chart showing spending for last 7 days">
          <div class="bars" id="trendBars" aria-hidden="true"></div>
          <div class="chart-labels" id="trendLabels"></div>
        </div>
      </section>
    </section>

    <!-- RECORDS -->
    <section class="panel" id="panel-records" aria-labelledby="h-records" hidden>
      <header class="panel-head">
        <h2 id="h-records">Records</h2>
        <p class="muted">Sort, search with regex, edit inline, or delete.</p>
      </header>

      <div class="toolbar">
        <div class="searchbox" role="search">
          <label for="regexInput">Live Regex Search</label>
          <div class="search-row">
            <input id="regexInput" type="text" placeholder="e.g. (coffee|tea) or \b(\w+)\s+\1\b" inputmode="text" />
            <label class="check">
              <input id="caseToggle" type="checkbox" />
              Case-insensitive
            </label>
          </div>
          <p class="hint" id="regexHint">Type a regex pattern. Invalid patterns won’t crash the app.</p>
        </div>

        <div class="sortbox">
          <label for="sortBy">Sort by</label>
          <select id="sortBy">
            <option value="date_desc">Date (new → old)</option>
            <option value="date_asc">Date (old → new)</option>
            <option value="desc_asc">Description (A → Z)</option>
            <option value="desc_desc">Description (Z → A)</option>
            <option value="amt_desc">Amount (high → low)</option>
            <option value="amt_asc">Amount (low → high)</option>
          </select>
        </div>
      </div>

      <!-- Desktop table -->
      <div class="table-wrap" id="tableWrap" aria-label="Records table">
        <table class="records-table">
          <caption class="sr-only">Transactions list</caption>
          <thead>
            <tr>
              <th scope="col">Date</th>
              <th scope="col">Description</th>
              <th scope="col">Category</th>
              <th scope="col" class="num">Amount</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody id="recordsTbody"></tbody>
        </table>
      </div>

      <!-- Mobile cards -->
      <div class="cards" id="recordsCards" aria-label="Records cards (mobile)"></div>
    </section>

    <!-- ADD/EDIT FORM -->
    <section class="panel" id="panel-add" aria-labelledby="h-add" hidden>
      <header class="panel-head">
        <h2 id="h-add">Add / Edit Transaction</h2>
        <p class="muted">Validation uses regex. Errors are announced to assistive tech.</p>
      </header>

      <form id="txnForm" novalidate>
        <input type="hidden" id="editId" value="" />

        <div class="grid-2">
          <div class="field">
            <label for="description">Description</label>
            <input id="description" name="description" type="text" placeholder="e.g., Lunch at cafeteria" required />
            <p class="error" id="errDescription" aria-live="polite"></p>
          </div>

          <div class="field">
            <label for="amount">Amount (base)</label>
            <input id="amount" name="amount" type="text" placeholder="e.g., 1200 or 12.50" inputmode="decimal" required />
            <p class="error" id="errAmount" aria-live="polite"></p>
          </div>

          <div class="field">
            <label for="category">Category</label>
            <input id="category" name="category" type="text" placeholder="Food, Books, Transport..." required />
            <p class="error" id="errCategory" aria-live="polite"></p>
          </div>

          <div class="field">
            <label for="date">Date (YYYY-MM-DD)</label>
            <input id="date" name="date" type="text" placeholder="2025-09-29" inputmode="numeric" required />
            <p class="error" id="errDate" aria-live="polite"></p>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" type="submit">Save</button>
          <button class="btn" id="resetBtn" type="button">Clear</button>
          <button class="btn danger" id="deleteBtn" type="button" disabled>Delete</button>
        </div>

        <p class="hint">
          Advanced regex rule: duplicate words like <code>"coffee coffee"</code> are blocked.
        </p>
      </form>
    </section>

    <!-- SETTINGS -->
    <section class="panel" id="panel-settings" aria-labelledby="h-settings" hidden>
      <header class="panel-head">
        <h2 id="h-settings">Settings</h2>
        <p class="muted">Currency + manual rates, cap/target, categories, import/export.</p>
      </header>

      <div class="settings-grid">
        <section class="card" aria-labelledby="h-currency">
          <h3 id="h-currency">Currency</h3>

          <div class="field">
            <label for="baseCurrency">Base currency</label>
            <select id="baseCurrency">
              <option value="RWF">RWF</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
            </select>
            <p class="hint">All amounts are stored in base currency. Rates are for display conversions only.</p>
          </div>

          <div class="grid-2">
            <div class="field">
              <label for="rateUSD">Rate (1 Base → USD)</label>
              <input id="rateUSD" type="text" inputmode="decimal" placeholder="e.g., 0.00075" />
            </div>
            <div class="field">
              <label for="rateEUR">Rate (1 Base → EUR)</label>
              <input id="rateEUR" type="text" inputmode="decimal" placeholder="e.g., 0.00069" />
            </div>
          </div>

          <button class="btn" id="saveRatesBtn" type="button">Save Currency Settings</button>
        </section>

        <section class="card" aria-labelledby="h-cap">
          <h3 id="h-cap">Cap / Target</h3>
          <div class="field">
            <label for="capValue">Monthly cap (base)</label>
            <input id="capValue" type="text" inputmode="decimal" placeholder="e.g., 200000" />
            <p class="hint">Dashboard announces remaining/overage using ARIA live.</p>
          </div>
          <button class="btn" id="saveCapBtn" type="button">Save Cap</button>
        </section>

        <section class="card" aria-labelledby="h-cats">
          <h3 id="h-cats">Categories</h3>
          <p class="muted small">Default: Food, Books, Transport, Entertainment, Fees, Other</p>
          <div class="field">
            <label for="categoriesInput">Comma-separated categories</label>
            <textarea id="categoriesInput" rows="3" placeholder="Food, Books, Transport, Entertainment, Fees, Other"></textarea>
          </div>
          <button class="btn" id="saveCatsBtn" type="button">Save Categories</button>
        </section>

        <section class="card" aria-labelledby="h-io">
          <h3 id="h-io">Import / Export JSON</h3>

          <div class="io-actions">
            <button class="btn" id="exportBtn" type="button">Export</button>
            <button class="btn" id="downloadSeedBtn" type="button">Download seed template</button>
          </div>

          <div class="field">
            <label for="importArea">Import JSON</label>
            <textarea id="importArea" rows="7" placeholder='Paste JSON array here...'></textarea>
            <p class="hint">Import validates structure & required keys before loading.</p>
          </div>
          <button class="btn primary" id="importBtn" type="button">Validate & Import</button>

          <div class="field">
            <label for="exportArea">Export output</label>
            <textarea id="exportArea" rows="7" readonly></textarea>
          </div>
        </section>
      </div>
    </section>

    <!-- ABOUT -->
    <section class="panel" id="panel-about" aria-labelledby="h-about" hidden>
      <header class="panel-head">
        <h2 id="h-about">About</h2>
      </header>

      <div class="card">
        <p>
          This Student Finance Tracker is a responsive, accessible, offline-first vanilla app.
          It demonstrates semantic HTML, mobile-first CSS, DOM manipulation, events, regex validation & regex search,
          localStorage persistence, and JSON import/export with validation.
        </p>

        <h3>Contact</h3>
        <ul>
          <li>GitHub: <a id="githubLink" href="#" rel="noopener">your-github</a></li>
          <li>Email: <a id="emailLink" href="#">your@email.com</a></li>
        </ul>

        <p class="muted small">
          Update your links in <code>scripts/state.js</code> (settings.user).
        </p>
      </div>
    </section>

    <footer class="site-footer">
      <p class="muted small">© <span id="year"></span> Student Finance Tracker — Vanilla HTML/CSS/JS</p>
    </footer>
  </main>

  <script type="module" src="./scripts/app.js"></script>

</body>
</html>
